### 协同系统-工作汇报v1.0详细设计说明书

> 控制级别： 内部资料

> 制定部门： 公共平台

###### 版本记录

版本|日期|修订者|变更内容
---|---|---|---
v1.0|2017.10.30|林泽鹏|新建

#### 目录

```
|--前言
|--|--编写目的
|--|--预期读者
|--|--参考资料
|
|--系统结构
|--|--技术选型
|--|--接口清单
|--|--数据库关系图
|--|--数据库表及字段
|--|--其他
```

#### 前言
##### 编写目的

    该文档编写目的为让工作汇报项目参与人及后续跟进人员快捷了解开发设计方案。

##### 预期读者

    本文档的阅读对象,例如：项目经理、负责软件设计与实现的软件开发人员、测试人员、使用手册等文档的编写人员、项目经理质量控制人员以及维护人员。

##### 参考资料

1. 协同系统-工作汇报需求规格说明书v1.0
1. 项目README文档
1. 项目swagger文档

#### 系统结构
##### 技术选型

```
springboot: 微服务框架
mysql: 数据库
mybatis: 持久层框架
maven: 构建工具
redis: 高性能存储系统
druid: 为监控而生的数据库连接池
swagger: Restful接口文档
docker: 轻量“虚拟机”，应用容器，开发测试部署一致体验
```

##### 接口清单

具体参详swagger接口文档, 如下为主要接口:

[swagger接口文档](http://192.168.1.149:8082/swagger-ui.html)

##### 数据库关系图

![](http://192.168.1.122:3000/SKB_PPS/pps-doc/raw/70b9b45ecc3ff34e1be3f2039a60b1003cb2e260/resource/%E5%8D%8F%E5%90%8C%E7%B3%BB%E7%BB%9F/%E5%B7%A5%E4%BD%9C%E6%B1%87%E6%8A%A5/%E8%AE%BE%E8%AE%A1%E8%AF%84%E5%AE%A1.png)

##### 数据库表及字段

- workreport_report(汇报表)

字段名|类型|描述
---|---|---
report_id|bigint|汇报主键ID
report_template_id|bigint|汇报模板ID
report_type|tinyint|汇报类型[enum: 1工作计划 2工作总结]
report_date_type|tinyint|汇报时间类型[enum: 1日报 2周报 3月报 4季报 5半年报 6年报]
content|json|汇报内容
begin_date|date|汇报开始时间
end_date|date|汇报结束时间

- workreport_report_template(汇报模板表)

字段名|类型|描述
---|---|---
report_template_id|bigint|汇报模板主键ID
report_type|tinyint|汇报类型[enum: 1工作计划 2工作总结]
report_date_type|tinyint|汇报时间类型[enum: 1日报 2周报 3月报 4季报 5半年报 6年报]
fields|json|汇报模板字段
is_inuse|bit|是否使用 0:否 1:是

- workreport_attach(附件表)

字段名|类型|描述
---|---|---
attach_id|bigint|附件主键ID
attach_name|varchar|附件名
relation_type|tinyint|附件关联类型[enum: 1汇报 ]
relation_id|bigint|附件关联ID
finder_id|bigint|文件服务器ID

- workreport_review(评论表)

字段名|类型|描述
---|---|---
review_id|bigint|评论主键ID
relation_type|tinyint|评论关联类型[enum: 1汇报]
relation_id|bigint|评论关联ID
root_review_id|bigint|根评论ID
to_review_id|bigint|被回复的对象ID
content|varchar|评论内容

- workreport_share(分享表)

字段名|类型|描述
---|---|---
share_id|bigint|分享主键ID
share_type|tinyint|分享资源类型[enum: 1汇报]
share_resource|bigint|分享资源ID

- workreport_share_target(分享对象表)

字段名|类型|描述
---|---|---
share_target_id|bigint|分享对象主键ID
share_id|bigint|分享ID
target_type|tinyint|分享对象类型[enum: 1用户 2部门 3群组 4公共组织]
target_id|varchar|分享对象ID

- workreport_operation_log(操作日志表)

字段名|类型|描述
---|---|---
operation_log_id|bigint|操作日志主键Id
relation_type|tinyint|操作日志关联类型[enum: 1汇报 2附件 3分享 4评论]
relation_id|bigint|操作日志关联ID
operate_type|tinyint|操作类型
operate_info|varchar|操作详细信息

- workreport_read(阅读表)

字段名|类型|描述
---|---|---
read_id|bigint|阅读主键ID
relation_type|tinyint|阅读关联类型[enum: 1汇报 ]
relation_id|bigint|阅读关联ID
read_time|datetime|阅读时间
read_number|bigint|阅读次数

##### 其他
1 汇报按时间进行分类，存储在单独的表中，通过日期类型标识（report_date_type），并且都有时间段，开始时间（begin_date），结束时间（end_date）

- 日报 
- 周报 
- 月报 
- 季报 
- 半年报 
- 年报

2 由于工作汇报模板后面可以实现自定义化，属于非结构化数据，考虑使用JSON格式进行数据存储

- 汇报模板表（fields）

```json
[
    {
        field: "0"，title: "工作内容及成果"
    }，{
        field: "1"，tilte: "问题及解决方案"
    }，{
        field: "1"，tilte: "下周计划"
    }，{
        field: "1"，tilte: "意见及建议"
    }
]
```

- 汇报表（content）

```json
[   
    {
        field: "0"，content: "XXX的工作内容及成果"
    }，{
        field: "1"，content: "XXX的问题及解决方案"
    }，{
        field: "1"，content: "XXX的下周计划"
    }，{
        field: "1"，content: "XXX的意见及建议"
    }
]
```

3 每张关联表（评论表、阅读表、分享表、操作记录）都有关联类型（relation_type），关联ID（relation_id）预留其他功能也可以使用对应的表结构